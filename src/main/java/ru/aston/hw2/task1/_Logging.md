# Логгирование в Java

## Введение

Логгирование в Java позволяет записывать информацию о работе программы для отладки, мониторинга и
диагностики. Основной инструмент — пакет `java.util.logging` (встроенный в JDK), хотя популярны и
сторонние библиотеки, такие как Log4j или SLF4J. Этот документ объясняет основы логгирования с
использованием `java.util.logging`, уровни логирования, создание статического и нестатического
логгера, а также их различия. Для Python-разработчиков: это аналог модуля `logging` в Python.

## Основы логгирования

В Java логгер (`Logger`) используется для отправки сообщений с определённым уровнем важности в
обработчики (`Handler`), такие как консоль или файл. Логгеры идентифицируются по имени, обычно
связанному с именем класса.

**Пример создания логгера**:

```java
import java.util.logging.Logger;

public class MyClass {

    private static final Logger logger = Logger.getLogger(MyClass.class.getName());
}
```

**Аналогия с Python**:

```python
import logging
logger = logging.getLogger(__name__)
```

## Уровни логирования

`java.util.logging` поддерживает следующие уровни логирования (от самого высокого приоритета к
низкому):

| Уровень   | Описание                                 | Аналог в Python           |
|-----------|------------------------------------------|---------------------------|
| `SEVERE`  | Критические ошибки (например, сбой).     | `logging.ERROR`           |
| `WARNING` | Предупреждения (потенциальные проблемы). | `logging.WARNING`         |
| `INFO`    | Информационные сообщения.                | `logging.INFO`            |
| `CONFIG`  | Конфигурационные данные.                 | `logging.DEBUG` (условно) |
| `FINE`    | Отладочная информация (низкий уровень).  | `logging.DEBUG`           |
| `FINER`   | Более детальная отладка.                 | Нет прямого аналога       |
| `FINEST`  | Максимально детальная отладка.           | Нет прямого аналога       |

**Пример**:

```java
logger.severe("Критическая ошибка!");
logger.

warning("Предупреждение.");
logger.

info("Информация о работе.");
logger.

fine("Детали для отладки.");
```

**Настройка уровня**:
По умолчанию логгер выводит сообщения уровня `INFO` и выше. Чтобы включить `FINE` или ниже,
настройте уровень:

```java
logger.setLevel(Level.FINE);
```

## Создание логгера

### 1. Статический логгер

Статический логгер создаётся с модификатором `static` и обычно используется для логирования на
уровне класса.

```java
import java.util.logging.Logger;

public class MyClass {

    private static final Logger logger = Logger.getLogger(MyClass.class.getName());

    public static void doSomething() {
        logger.info("Выполняется статический метод.");
    }
}
```

- **Когда использовать**: Для общих сообщений, связанных с классом, а не с конкретным экземпляром.
- **Особенности**: Один логгер на весь класс, экономит ресурсы, доступен без создания объекта.

### 2. Нестатический логгер

Нестатический логгер создаётся для каждого экземпляра класса.

```java
import java.util.logging.Logger;

public class MyClass {

    private final Logger logger;

    public MyClass() {
        this.logger = Logger.getLogger(this.getClass().getName());
    }

    public void doSomething() {
        logger.info("Выполняется метод экземпляра.");
    }
}
```

- **Когда использовать**: Если нужно логировать информацию, специфичную для экземпляра (например, с
  уникальным идентификатором объекта).
- **Особенности**: Каждый объект имеет свой логгер, что может быть полезно для различения логов от
  разных экземпляров.

## Разница между статическим и нестатическим логгером

| **Аспект**           | **Статический логгер**                                 | **Нестатический логгер**                       |
|----------------------|--------------------------------------------------------|------------------------------------------------|
| **Область действия** | Общий для всего класса.                                | Привязан к экземпляру класса.                  |
| **Память**           | Один экземпляр на класс, экономит ресурсы.             | Один экземпляр на объект, больше памяти.       |
| **Использование**    | Для общих событий (например, инициализация).           | Для событий, связанных с состоянием объекта.   |
| **Пример контекста** | Логирование статических методов или ошибок приложения. | Логирование действий конкретного пользователя. |

**Аналогия с Python**:

- Статический логгер похож на `logging.getLogger(__name__)` в модуле Python.
- Нестатический логгер ближе к созданию логгера с уникальным именем для каждого объекта, например,
  `logging.getLogger(f"{__name__}.{id(self)}")`.

## Настройка вывода логов

По умолчанию логи выводятся в консоль, но только для уровня `INFO` и выше. Чтобы выводить `FINE` или
логировать в файл, настройте обработчик (`Handler`):

```java
import java.util.logging.ConsoleHandler;
import java.util.logging.Level;

public class MyClass {

    private static final Logger logger = Logger.getLogger(MyClass.class.getName());

    static {
        logger.setLevel(Level.FINE);
        ConsoleHandler handler = new ConsoleHandler();
        handler.setLevel(Level.FINE);
        logger.addHandler(handler);
    }
}
```

**Логирование в файл**:

```java
import java.util.logging.FileHandler;

FileHandler fileHandler = new FileHandler("app.log");
fileHandler.

setLevel(Level.ALL);
logger.

addHandler(fileHandler);
```

**Аналогия с Python**:

```python
import logging
logging.basicConfig(level=logging.DEBUG, filename="app.log")
logger = logging.getLogger(__name__)
```

## Типичные ошибки

1. **Логи уровня `FINE` не выводятся**:
    - **Причина**: Логгер или обработчик настроен на уровень `INFO` или выше.
    - **Решение**: Установите `Level.FINE` для логгера и обработчика:
      ```java
      logger.setLevel(Level.FINE);
      ConsoleHandler handler = new ConsoleHandler();
      handler.setLevel(Level.FINE);
      logger.addHandler(handler);
      ```

2. **Использование `peek` для логирования**:
    - **Причина**: В твоём коде `peek(student -> logger.fine("Студент: " + student))` не выводил
      логи из-за уровня логирования и побочных эффектов в стримах.
    - **Решение**: Замените `peek` на `forEach` или настройте уровень логирования.

3. **Слишком много логгеров**:
    - **Причина**: Создание нестатического логгера для каждого объекта увеличивает потребление
      памяти.
    - **Решение**: Используйте статический логгер, если логи не зависят от состояния объекта.

## Лучшие практики

1. **Используйте статический логгер по умолчанию**: Он экономичен и подходит для большинства
   случаев.
2. **Настраивайте уровень логирования**: Установите `Level.FINE` для отладки, `Level.INFO` для
   продакшена.
3. **Избегайте побочных эффектов в стримах**: Не используйте `peek` для логирования в
   продакшен-коде.
4. **Логируйте осмысленно**: Используйте `SEVERE` для ошибок, `INFO` для ключевых событий, `FINE`
   для отладки.
5. **Добавляйте контекст**: Включайте в логи идентификаторы объектов или сессий для удобства
   анализа.

## Пример из твоего кода

В твоём коде (`main.java.ru.aston.hw2.task2`) логгер не выводил сообщения уровня `FINE` из-за
стандартной
настройки уровня `INFO`. Исправленный код:

```java
import java.util.logging.Logger;
import java.util.logging.ConsoleHandler;
import java.util.logging.Level;

public class main.

Main {

    private static final Logger logger = Logger.getLogger(main.Main.class.getName());

    static {
        logger.setLevel(Level.FINE);
        ConsoleHandler handler = new ConsoleHandler();
        handler.setLevel(Level.FINE);
        logger.addHandler(handler);
    }

    public static void main (String[]args){
        logger.fine("Это сообщение теперь видно!");
        logger.info("Это информационное сообщение.");
    }
}
```

**Вывод**:

```
FINE: Это сообщение теперь видно!
INFO: Это информационное сообщение.
```

## Заключение

Логгирование в Java с `java.util.logging` — это мощный инструмент, аналогичный модулю `logging` в
Python. Используйте статические логгеры для общих задач, нестатические — для специфичных к объектам,
настраивайте уровни логирования и обработчики для нужного вывода. Правильная настройка логгера и
избегание побочных эффектов в стримах (как в твоём случае с `peek`) сделают логирование эффективным
и удобным.